# 7æœˆ11æ—¥
## ä½œç‰©æ‚äº¤
### é¢˜ç›®æè¿°
ä½œç‰©æ‚äº¤æ˜¯ä½œç‰©æ ½åŸ¹ä¸­é‡è¦çš„ä¸€æ­¥ã€‚å·²çŸ¥æœ‰ ğ‘ ç§ä½œç‰© (ç¼–å· 1 è‡³ ğ‘)ï¼Œç¬¬ ğ‘– ç§ä½œç‰©ä»æ’­ç§åˆ°æˆç†Ÿçš„æ—¶é—´ä¸º ğ‘‡ğ‘–ã€‚ä½œç‰©ä¹‹é—´ä¸¤ä¸¤å¯ä»¥è¿›è¡Œæ‚äº¤ï¼Œæ‚äº¤æ—¶é—´å–ä¸¤ç§ä¸­æ—¶é—´è¾ƒé•¿çš„ä¸€æ–¹ã€‚å¦‚ä½œç‰© A ç§æ¤æ—¶é—´ä¸º 5 å¤©ï¼Œä½œç‰© B ç§æ¤æ—¶é—´ä¸º 7 å¤©ï¼Œåˆ™ AB æ‚äº¤èŠ±è´¹çš„æ—¶é—´ä¸º 7 å¤©ã€‚ä½œç‰©æ‚äº¤ä¼šäº§ç”Ÿå›ºå®šçš„ä½œç‰©ï¼Œæ–°äº§ç”Ÿçš„ä½œç‰©ä»ç„¶å±äº ğ‘ ç§ä½œç‰©ä¸­çš„ä¸€ç§ã€‚

åˆå§‹æ—¶ï¼Œæ‹¥æœ‰å…¶ä¸­ ğ‘€ ç§ä½œç‰©çš„ç§å­ (æ•°é‡æ— é™ï¼Œå¯ä»¥æ”¯æŒå¤šæ¬¡æ‚äº¤)ã€‚åŒæ—¶å¯ä»¥è¿›è¡Œå¤šä¸ªæ‚äº¤è¿‡ç¨‹ã€‚æ±‚é—®å¯¹äºç»™å®šçš„ç›®æ ‡ç§å­ï¼Œæœ€å°‘éœ€è¦å¤šå°‘å¤©èƒ½å¤Ÿå¾—åˆ°ã€‚

å¦‚å­˜åœ¨ 4 ç§ä½œç‰© ABCDï¼Œå„è‡ªçš„æˆç†Ÿæ—¶é—´ä¸º 5 å¤©ã€7 å¤©ã€3 å¤©ã€8 å¤©ã€‚åˆå§‹æ‹¥æœ‰ AB ä¸¤ç§ä½œç‰©çš„ç§å­ï¼Œç›®æ ‡ç§å­ä¸º Dï¼Œå·²çŸ¥æ‚äº¤æƒ…å†µä¸º $A \times B \rightarrow  C$ï¼Œ$A \rightarrow  C â†’ D$ã€‚åˆ™æœ€çŸ­çš„æ‚äº¤è¿‡ç¨‹ä¸ºï¼š

ç¬¬ 1 å¤©åˆ°ç¬¬ 7 å¤© (ä½œç‰© B çš„æ—¶é—´)ï¼Œ$A \times B \rightarrow  C$ã€‚

ç¬¬ 8 å¤©åˆ°ç¬¬ 12 å¤© (ä½œç‰© A çš„æ—¶é—´)ï¼Œ$A \times C \rightarrow  D$ã€‚

èŠ±è´¹ 12 å¤©å¾—åˆ°ä½œç‰© D çš„ç§å­ã€‚

**è¾“å…¥æè¿°**
è¾“å…¥çš„ç¬¬ 1 è¡ŒåŒ…å« 4 ä¸ªæ•´æ•° $N,M,K,T$ï¼Œ$N$ è¡¨ç¤ºä½œç‰©ç§ç±»æ€»æ•° (ç¼–å· $1$ è‡³ $N$)ï¼Œ$M$ è¡¨ç¤ºåˆå§‹æ‹¥æœ‰çš„ä½œç‰©ç§å­ç±»å‹æ•°é‡ï¼Œ$K$ è¡¨ç¤ºå¯ä»¥æ‚äº¤çš„æ–¹æ¡ˆæ•°ï¼Œ$T$ è¡¨ç¤ºç›®æ ‡ç§å­çš„ç¼–å·ã€‚

ç¬¬ 2 è¡ŒåŒ…å« N ä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬ i ä¸ªæ•´æ•°è¡¨ç¤ºç¬¬ i ç§ä½œç‰©çš„ç§æ¤æ—¶é—´ 
$ğ‘‡_ğ‘–(1â‰¤T_i â‰¤100)$ã€‚

ç¬¬ 3 è¡ŒåŒ…å« M ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºå·²æ‹¥æœ‰çš„ç§å­ç±»å‹ $ğ¾_ğ‘—(1â‰¤K_jâ‰¤M)$ï¼Œ
K_jä¸¤ä¸¤ä¸åŒã€‚

ç¬¬ 4 è‡³ $K + 3$ è¡Œï¼Œæ¯è¡ŒåŒ…å« 3 ä¸ªæ•´æ•° A,B,Cï¼Œè¡¨ç¤ºç¬¬ A ç±»ä½œç‰©å’Œç¬¬ B ç±»ä½œç‰©æ‚äº¤å¯ä»¥è·å¾—ç¬¬ C ç±»ä½œç‰©çš„ç§å­ã€‚å…¶ä¸­ï¼Œ$1â‰¤Nâ‰¤2000,2â‰¤Mâ‰¤N,1â‰¤Kâ‰¤10^5,1â‰¤Tâ‰¤N$, ä¿è¯ç›®æ ‡ç§å­ä¸€å®šå¯ä»¥é€šè¿‡æ‚äº¤å¾—åˆ°ã€‚

**è¾“å‡ºæè¿°**
è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå¾—åˆ°ç›®æ ‡ç§å­çš„æœ€çŸ­æ‚äº¤æ—¶é—´ã€‚

>è¾“å…¥
6 2 4 6
5 3 4 6 4 9
1 2
1 2 3
1 3 4
2 3 5
4 5 6

>è¾“å‡º
16

>æ ·ä¾‹è¯´æ˜
ç¬¬ 1 å¤©è‡³ç¬¬ 5 å¤©ï¼Œå°†ç¼–å· 1 ä¸ç¼–å· 2 çš„ä½œç‰©æ‚äº¤ï¼Œå¾—åˆ°ç¼–å· 3 çš„ä½œç‰©ç§å­ã€‚
ç¬¬ 6 å¤©è‡³ç¬¬ 10 å¤©ï¼Œå°†ç¼–å· 1 ä¸ç¼–å· 3 çš„ä½œç‰©æ‚äº¤ï¼Œå¾—åˆ°ç¼–å· 4 çš„ä½œç‰©ç§å­ã€‚
ç¬¬ 6 å¤©è‡³ç¬¬ 9 å¤©ï¼Œå°†ç¼–å· 2 ä¸ç¼–å· 3 çš„ä½œç‰©æ‚äº¤ï¼Œå¾—åˆ°ç¼–å· 5 çš„ä½œç‰©ç§å­ã€‚
ç¬¬ 11 å¤©è‡³ç¬¬ 16 å¤©ï¼Œå°†ç¼–å· 4 ä¸ç¼–å· 5 çš„ä½œç‰©æ‚äº¤ï¼Œå¾—åˆ°ç¼–å· 6 çš„ä½œç‰©ç§å­ã€‚
æ€»å…±èŠ±è´¹ 16 å¤©ã€‚

`è¿è¡Œé™åˆ¶`
`æœ€å¤§è¿è¡Œæ—¶é—´ï¼š2s`
`æœ€å¤§è¿è¡Œå†…å­˜: 256M`

### é¢˜ç›®åˆ†æ
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯æ±‚æœ€çŸ­è·¯å¾„,æˆ‘ä»¬å¯ä»¥æŠŠä½œç‰©çœ‹ä½œæ˜¯å›¾ä¸­çš„ç‚¹,æ‚äº¤çœ‹ä½œæ˜¯è¾¹,ç„¶åæ±‚æœ€çŸ­è·¯å¾„,è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨dijkstraç®—æ³•æ¥æ±‚è§£.æˆ‘ä»¬éå†æ‰€æœ‰æ‚äº¤æ–¹æ¡ˆï¼Œæ£€æŸ¥çˆ¶æœ¬æ˜¯å¦å­˜åœ¨ä¸”äº§ç‰©çš„æœ€çŸ­æ—¶é—´æœªç¡®å®š,ç„¶åè®¡ç®—æ‚äº¤æ‰€éœ€æ—¶é—´å’Œæœ€æ—©å¼€å§‹æ—¶é—´ï¼Œæ›´æ–°äº§ç‰©çš„æœ€çŸ­æ—¶é—´ï¼ˆå¦‚æœæ›´ä¼˜ï¼‰ã€‚å¾ªç¯ç»“æŸä»£è¡¨æ‰¾åˆ°æœ¬è½®æ‚äº¤åä»æœªç¡®å®šæœ€çŸ­æ—¶é—´ä½†æ—¶é—´æœ€çŸ­çš„ç‰©ç§
æˆ‘ä»¬é€šè¿‡è¿­ä»£çš„æ–¹å¼ï¼Œé€šè¿‡è´ªå¿ƒé€æ­¥æ›´æ–°å¹¶ç¡®å®šæ¯ä¸ªå†œä½œç‰©çš„æœ€çŸ­è·å¾—æ—¶é—´ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡ç‰©ç§çš„æœ€çŸ­è·¯å¾„ã€‚

### ä»£ç å®ç°
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2020;
int n, m, k, t;
int a[N];
vector<pair<int, int>> g[N];
bool st[N], backup[N];
int d[N];
pair<int, int> p[N];

int main() {
    memset(d, 0x3f3f3f3f, sizeof d);
    cin >> n >> m >> k >> t;
    for (int i = 1; i <= n; i++)
        cin >> a[i];
    for (int i = 0; i < m; i++) {
        int x;
        cin >> x;
        st[x] = true;
        d[x] = 0;
    }
    for (int i = 0; i < k; i++) {
        int x, y, a;
        cin>>x>>y>>a;
        g[a].push_back(make_pair(x, y));
    }

    for (int i = 1; i <= n; i++)
        for (int j = 0; j < (int)g[i].size(); j++)
            if (st[g[i][j].first] && st[g[i][j].second]) {
                int rd = d[i];
                d[i] = min(d[i], max(a[g[i][j].first], a[g[i][j].second]));
                if (d[i] < rd)
                    p[i] = make_pair(g[i][j].first, g[i][j].second);
            }

    for (int i = 1; i <= n; i++) {
        int minv = 0x3f3f3f3f;
        int v;
        for (int j = 1; j <= n; j++) {
            if (!st[j] && d[j] < minv) {
                v = j;
                minv = d[j];
            }
        }
        st[v] = true;

        for (int j = 1; j <= n; j++)
            for (int l = 0; l < (int)g[j].size(); l++)
                if (!st[j] && st[g[j][l].first] && st[g[j][l].second]) {
                    int rd = d[j];
                    d[j] = min(d[j],
                               max(a[g[j][l].first], a[g[j][l].second]) + d[v]);
                    if (d[j] < rd)
                        p[j] = make_pair(g[j][l].first, g[j][l].second);
                }
    }

    cout << d[t] << endl;

    return 0;
}
```
## å‡ºç§Ÿè½¦


## é¢˜ç›®èƒŒæ™¯

å°è“åœ¨ $L$ å¸‚å¼€å‡ºç§Ÿè½¦ã€‚

## é¢˜ç›®æè¿°

$L$ å¸‚çš„è§„åˆ’å¾ˆè§„æ•´ï¼Œæ‰€æœ‰çš„è·¯éƒ½æ˜¯æ­£ä¸œè¥¿å‘æˆ–è€…æ­£å—åŒ—å‘çš„ï¼Œé“è·¯éƒ½å¯ä»¥çœ‹æˆç›´çº¿æ®µã€‚ä¸œè¥¿å‘çš„é“è·¯äº’ç›¸å¹³è¡Œ, å—åŒ—å‘çš„é“è·¯äº’ç›¸å¹³è¡Œï¼Œä»»ä½•ä¸€æ¡ä¸œè¥¿å‘é“è·¯å‚ç›´äºä»»ä½•ä¸€æ¡å—åŒ—å‘é“è·¯ã€‚

ä»åŒ—åˆ°å—ä¸€å…±æœ‰ $n$ æ¡ä¸œè¥¿å‘é“è·¯ï¼Œä¾æ¬¡æ ‡å·ä¸º $H_{1}, H_{2}, \cdots, H_{n}$ ã€‚ä»è¥¿åˆ°ä¸œ ä¸€å…±æœ‰ $m$ æ¡å—åŒ—å‘çš„é“è·¯ï¼Œä¾æ¬¡æ ‡å·ä¸º $S_{1}, S_{2}, \cdots, S_{m}$ ã€‚

æ¯æ¡é“è·¯éƒ½æœ‰è¶³å¤Ÿé•¿ï¼Œæ¯ä¸€æ¡ä¸œè¥¿å‘é“è·¯å’Œæ¯ä¸€æ¡å—åŒ—å‘é“è·¯éƒ½ç›¸äº¤ï¼Œ$H_{i}$ ä¸ $S_{j}$ çš„äº¤å‰è·¯å£è®°ä¸º $(i, j)$ ã€‚

ä» $H_{1}$ å’Œ $S_{1}$ çš„äº¤å‰è·¯å£ $(1,1)$ å¼€å§‹ï¼Œå‘å—é‡åˆ°çš„è·¯å£ä¸ $(1,1)$ çš„è·ç¦»åˆ†åˆ« æ˜¯ $h_{1}, h_{2}, \cdots, h_{n-1}$ï¼Œå‘ä¸œé‡åˆ°è·¯å£ä¸ $(1,1)$ çš„è·ç¦»åˆ†åˆ«æ˜¯ $w_{1}, w_{2}, \cdots, w_{m-1}$ ã€‚

é“è·¯çš„æ¯ä¸ªè·¯å£éƒ½æœ‰ä¸€ä¸ªçº¢ç»¿ç¯ã€‚

æ—¶åˆ» $0$ çš„æ—¶å€™ï¼Œå—åŒ—å‘ç»¿ç¯äº®ï¼Œä¸œè¥¿å‘çº¢ç¯äº®ï¼Œå—åŒ—å‘çš„ç»¿ç¯ä¼šæŒç»­ä¸€æ®µæ—¶é—´ï¼ˆæ¯ä¸ªè·¯å£ä¸åŒ)ï¼Œç„¶åå—åŒ—å‘å˜æˆçº¢ç¯ï¼Œä¸œè¥¿å‘å˜æˆç»¿ç¯ï¼ŒæŒç»­ä¸€æ®µæ—¶é—´åï¼Œå†å˜æˆå—åŒ—å‘ç»¿ç¯ï¼Œä¸œè¥¿å‘çº¢ç¯ã€‚

å·²çŸ¥è·¯å£ $(i, j)$ çš„å—åŒ—å‘ç»¿ç¯æ¯æ¬¡æŒç»­çš„æ—¶é—´ä¸º $g_{i j}$, ä¸œè¥¿å‘çš„ç»¿ç¯æ¯æ¬¡æŒç»­çš„æ—¶é—´ä¸º $r_{i j}$, çº¢ç»¿ç¯çš„å˜æ¢æ—¶é—´å¿½ç•¥ã€‚

å½“ä¸€è¾†è½¦èµ°åˆ°è·¯å£æ—¶ï¼Œå¦‚æœæ˜¯ç»¿ç¯ï¼Œå¯ä»¥ç›´è¡Œã€å·¦è½¬æˆ–å³è½¬ã€‚å¦‚æœæ˜¯çº¢ç¯ï¼Œå¯ä»¥å³è½¬ï¼Œä¸èƒ½ç›´è¡Œæˆ–å·¦è½¬ã€‚å¦‚æœåˆ°è·¯å£çš„æ—¶å€™åˆšå¥½ç”±çº¢ç¯å˜ä¸ºç»¿ç¯ï¼Œåˆ™è§†ä¸ºçœ‹åˆ°ç»¿ç¯ï¼›å¦‚æœåˆšå¥½ç”±ç»¿ç¯å˜ä¸ºçº¢ç¯ï¼Œåˆ™è§†ä¸ºçœ‹åˆ°çº¢ç¯ã€‚

æ¯æ®µé“è·¯éƒ½æ˜¯åŒå‘é“è·¯ï¼Œé“è·¯ä¸­é—´æœ‰éš”ç¦»æ æ†ï¼Œåœ¨é“è·¯ä¸­é—´ä¸èƒ½æ‰å¤´, åªèƒ½åœ¨çº¢ç»¿ç¯è·¯å£æ‰å¤´ã€‚æ‰å¤´æ—¶ä¸ç®¡æ˜¯çº¢ç¯è¿˜æ˜¯ç»¿ç¯éƒ½å¯ä»¥ç›´æ¥æ‰å¤´ã€‚æ‰å¤´çš„æ—¶é—´å¯ä»¥å¿½ç•¥ã€‚

å°è“æ—¶åˆ» $0$ ä»å®¶å‡ºå‘ã€‚ä»Šå¤©ï¼Œä»–æ¥åˆ°äº† $q$ ä¸ªé¢„çº¦çš„è®¢å•ï¼Œä»–æ‰“ç®—æŒ‰ç…§è®¢å• çš„é¡ºåºä¾æ¬¡å®Œæˆè¿™äº›è®¢å•ï¼Œå°±å›å®¶ä¼‘æ¯ã€‚ä¸­é€”å°è“ä¸å‡†å¤‡å†æ‹‰å…¶ä»–ä¹˜å®¢ã€‚å°è“çš„å®¶åœ¨ä¸¤ä¸ªè·¯å£çš„ä¸­ç‚¹ï¼Œå°è“å–œæ¬¢ç”¨ $x_{1}, y_{1}, x_{2}, y_{2}$ æ¥è¡¨ç¤ºè‡ªå·±å®¶çš„ä½ ç½®, å³è·¯å£ $\left(x_{1}, y_{1}\right)$ åˆ°è·¯å£ $\left(x_{2}, y_{2}\right)$ ä¹‹é—´çš„é“è·¯ä¸­ç‚¹çš„å³ä¾§, ä¿è¯ä¸¤ä¸ªè·¯å£ç›¸é‚» (ä¸­é—´æ²¡æœ‰å…¶ä»–è·¯å£)ã€‚è¯·æ³¨æ„å½“ä¸¤ä¸ªè·¯å£äº¤æ¢ä½ç½®æ—¶ï¼Œè¡¨è¾¾çš„æ˜¯è·¯çš„ä¸åŒä¸¤è¾¹ï¼Œè·¯ä¸­é—´æœ‰æ æ†ï¼Œå› æ­¤è¿™ä¸¤ä¸ªä½ç½®å®é™…è¦èµ°æ¯”è¾ƒè¿œæ‰èƒ½åˆ°è¾¾ã€‚

å°è“çš„è®¢å•ä¹Ÿæ˜¯ä»æŸä¸¤ä¸ªè·¯å£é—´çš„ä¸­ç‚¹å‡ºå‘ï¼Œåˆ°æŸä¸¤ä¸ªè·¯å£é—´çš„ä¸­ç‚¹ç»“æŸã€‚å°è“å¿…é¡»æŒ‰ç…§ç»™å®šçš„é¡ºåºå¤„ç†è®¢å•ï¼Œè€Œä¸”ä¸€ä¸ªæ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªè®¢å•ï¼Œä¸èƒ½å›¾çœæ—¶é—´è€ŒåŒæ—¶æ¥ä¸¤ä½ä¹˜å®¢ï¼Œä¹Ÿä¸èƒ½æ·é˜Ÿå®Œæˆåé¢çš„è®¢å•ã€‚

å°è“åªå¯¹ $L$ å¸‚æ¯”è¾ƒç†Ÿï¼Œå› æ­¤ä»–åªä¼šåœ¨ç»™å®šçš„ $n$ æ¡ä¸œè¥¿å‘é“è·¯å’Œ $m$ æ¡å—åŒ—å‘é“è·¯ä¸Šè¡Œé©¶ï¼Œè€Œä¸”ä¸ä¼šé©¶å‡º $H_{1}, H_{n}, S_{1}, S_{m}$ è¿™å‡ æ¡é“è·¯æ‰€ç¡®å®šçš„çŸ©å½¢åŒºåŸŸ å¯ä»¥åˆ°è¾¹ç•Œã€‚

å°è“è¡Œè½¦é€Ÿåº¦ä¸€ç›´ä¸º $1$ï¼Œä¹˜å®¢ä¸Šä¸‹è½¦çš„æ—¶é—´å¿½ç•¥ä¸è®¡ã€‚

è¯·é—®ï¼Œå°è“æœ€æ—©ä»€ä¹ˆæ—¶å€™èƒ½å®Œæˆæ‰€æœ‰è®¢å•å›åˆ°å®¶ã€‚

## è¾“å…¥æ ¼å¼

è¾“å…¥ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $n, m$ï¼Œè¡¨ç¤ºä¸œè¥¿å‘é“è·¯çš„æ•°é‡å’Œå—åŒ—å‘é“è·¯çš„æ•° é‡ã€‚

ç¬¬äºŒè¡ŒåŒ…å« $n-1$ ä¸ªæ•´æ•° $h_{1}, h_{2}, \cdots, h_{n-1}$ ã€‚

ç¬¬ä¸‰è¡ŒåŒ…å« $m-1$ ä¸ªæ•´æ•° $w_{1}, w_{2}, \cdots, w_{m-1}$ ã€‚

æ¥ä¸‹æ¥ $n$ è¡Œ, æ¯è¡Œ $m$ ä¸ªæ•´æ•°ï¼Œæè¿°æ¯ä¸ªè·¯å£å—åŒ—å‘ç»¿ç¯çš„æ—¶é—´ï¼Œå…¶ä¸­çš„ç¬¬ $i$ è¡Œç¬¬ $j$ åˆ—è¡¨ç¤º $g_{i j}$ ã€‚

æ¥ä¸‹æ¥ $n$ è¡Œ, æ¯è¡Œ $m$ ä¸ªæ•´æ•°ï¼Œæè¿°æ¯ä¸ªè·¯å£ä¸œè¥¿å‘ç»¿ç¯çš„æ—¶é—´ï¼Œå…¶ä¸­çš„ç¬¬ $i$ è¡Œç¬¬ $j$ åˆ—è¡¨ç¤º $r_{i j}$ ã€‚

æ¥ä¸‹æ¥ä¸€è¡ŒåŒ…å«å››ä¸ªæ•´æ•° $x_{1}, y_{1}, x_{2}, y_{2}$ï¼Œè¡¨ç¤ºå°è“å®¶çš„ä½ç½®åœ¨è·¯å£ $\left(x_{1}, y_{1}\right)$ åˆ°è·¯å£ $\left(x_{2}, y_{2}\right)$ ä¹‹é—´çš„é“è·¯ä¸­ç‚¹çš„å³ä¾§ã€‚

æ¥ä¸‹æ¥ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° $q$ï¼Œè¡¨ç¤ºè®¢å•æ•°é‡ã€‚

æ¥ä¸‹æ¥ $q$ è¡Œï¼Œæ¯è¡Œæè¿°ä¸€ä¸ªè®¢å•ï¼Œå…¶ä¸­ç¬¬ $i$ è¡ŒåŒ…å«å…«ä¸ªæ•´æ•° $x_{i 1}, y_{i 1}, x_{i 2}, y_{i 2}$ï¼Œ$x_{i 3}, y_{i 3}, x_{i 4}, y_{i 4}$ï¼Œè¡¨ç¤ºç¬¬ $i$ ä¸ªè®¢å•çš„èµ·ç‚¹ä¸ºè·¯å£ $\left(x_{i 1}, y_{i 1}\right)$ åˆ°è·¯å£ $\left(x_{i 2}, y_{i 2}\right)$ ä¹‹é—´çš„é“ è·¯ä¸­ç‚¹çš„å³ä¾§ï¼Œç¬¬ $i$ ä¸ªè®¢å•çš„ç»ˆç‚¹ä¸ºè·¯å£ $\left(x_{i 3}, y_{i 3}\right)$ åˆ°è·¯å£ $\left(x_{i 4}, y_{i 4}\right)$ ä¹‹é—´çš„é“è·¯ä¸­ ç‚¹çš„å³ä¾§ã€‚

## è¾“å‡ºæ ¼å¼

è¾“å‡ºä¸€ä¸ªå®æ•°ï¼Œè¡¨ç¤ºå°è“å®Œæˆæ‰€æœ‰è®¢å•æœ€åå›åˆ°å®¶çš„æœ€æ—©æ—¶åˆ»ã€‚å››èˆäº”å…¥ä¿ç•™ä¸€ä½å°æ•°ã€‚

## æ ·ä¾‹ #1

### æ ·ä¾‹è¾“å…¥ #1

```
2 3
200
100 400
10 20 10
20 40 30
20 20 20
20 20 20
2 1 1 1
1
2 2 1 2 1 2 1 3
```

### æ ·ä¾‹è¾“å‡º #1

```
1620.0
```

## æç¤º

**ã€æ ·ä¾‹è¯´æ˜ã€‘**

è“æœ‰ä¸€ä¸ªè®¢å•, ä»–çš„è¡Œè½¦è·¯çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶ä¸­ $\mathrm{H}$ è¡¨ç¤ºä»–å®¶çš„ä½ç½®, $\mathrm{S}$ è¡¨ç¤ºè®¢å•çš„èµ·ç‚¹, $\mathrm{T}$ è¡¨ç¤ºè®¢å•çš„ç»ˆç‚¹ã€‚å°å°æ˜åœ¨æœ€åå›å®¶æ—¶è¦åœ¨ç›´è¡Œçš„çº¢ç»¿ç¯è·¯ å£ç­‰ç»¿ç¯, ç­‰å¾…æ—¶é—´ä¸º $20$ã€‚ 

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-15.jpg)

**ã€è¯„æµ‹ç”¨ä¾‹è§„æ¨¡ä¸çº¦å®šã€‘**

å¯¹äº $20 \%$ çš„è¯„æµ‹ç”¨ä¾‹, $1 \leq n, m \leq 5,1 \leq q \leq 10$ ã€‚

å¯¹äº $50 \%$ çš„è¯„æµ‹ç”¨ä¾‹, $1 \leq n, m \leq 30,1 \leq q \leq 30$ ã€‚

å¯¹äºæ‰€æœ‰è¯„æµ‹ç”¨ä¾‹, $1 \leq n, m \leq 100,1 \leq q \leq 30,1 \leq h_{1}<h_{2}<\cdots<h_{n-1} \leq$ $100000,1 \leq w_{1}<w_{2}<\cdots<w_{m-1} \leq 100000,1 \leq g_{i j} \leq 1000,1 \leq r_{i j} \leq 1000$, ç»™å®šçš„è·¯å£ä¸€å®šåˆæ³•ã€‚

### é¢˜ç›®åˆ†æ
~~åˆ«çœ‹è¿™é“é¢˜è¿™ä¹ˆé•¿,å…¶å®å®ƒä¸€ç‚¹ä¹Ÿä¸ç®€å•~~,æ´›è°·ç»™éš¾åº¦å®šä¸ºäº†è“é¢˜,æ ¸å¿ƒåšæ³•æ˜¯dijstraç®—æ³•åŠ å †ä¼˜åŒ–
![1721273578037.png](https://img.picui.cn/free/2024/07/18/66988c48b66be.png)
 æˆ‘ä»¬æ‰¾æœ€çŸ­è·¯çš„æ—¶å€™ä¸èƒ½ç®€å•çš„æŠŠé¡¶ç‚¹çœ‹ä½œæ˜¯è·¯å£, è€Œæ˜¯è¦æŠŠèµ·å§‹ç‚¹å’Œç»ˆç‚¹å®šä¸ºä¸¤ä¸ªè·¯å£ä¹‹é—´çš„ä¸­ç‚¹,ç„¶åå†dijæ‰¾æœ€çŸ­è·¯çš„æ—¶å€™æ¨¡æ‹Ÿè½¦è¾†é‡åˆ°çº¢ç»¿ç¯çš„æƒ…å†µ
### ä»£ç å®ç°
```cpp
#include <bits/stdc++.h>
using namespace std;

struct Pos {
    int index;
    double value;
    Pos(int i, double v) : index(i), value(v) {}
    bool operator<(const Pos &r) const { return value > r.value; }
};
int n, m;
int h[105], w[105];
int g[105][105], r[105][105];
int map(int x1, int y1, int x2, int y2) {
    if (x1 == x2 && y1 < y2)
        return (x1 - 1) * (m - 1) + y1 - 1;
    if (x1 == x2 && y1 > y2)
        return (x1 - 1) * (m - 1) + y2 - 1 + n * (m - 1);
    if (x1 < x2 && y1 == y2)
        return (x1 - 1) * m + y1 - 1 + 2 * n * (m - 1);
    if (x1 > x2 && y1 == y2)
        return (x2 - 1) * m + y1 - 1 + 2 * n * (m - 1) + (n - 1) * m;
}
double cal_time(int x1, int y1, int x2, int y2, double cur_t, int op) {
    if (op == 0) // è°ƒå¤´
    {
        if (x1 == x2)
            return w[y1 < y2 ? y1 : y2];
        else
            return h[x1 < x2 ? x1 : x2];
    }
    if (op == 1) // å³è½¬
    {
        if (x1 == x2 && y1 < y2) // è¥¿å‘ä¸œè½¬åŒ—å‘å—
            return w[y1] * 0.5 + h[x1] * 0.5;
        if (x1 == x2 && y1 > y2) // ä¸œå‘è¥¿è½¬å—å‘åŒ—
            return w[y2] * 0.5 + h[x1 - 1] * 0.5;
        if (x1 < x2 && y1 == y2) // åŒ—å‘å—è½¬ä¸œå‘è¥¿
            return w[y1 - 1] * 0.5 + h[x1] * 0.5;
        if (x1 > x2 && y1 == y2) // å—å‘åŒ—è½¬è¥¿å‘ä¸œ
            return w[y1] * 0.5 + h[x2] * 0.5;
    }
    if (op == 2) // ç›´è¡Œ
    {
        double time;
        if (x1 == x2) {
            if (y1 < y2) {
                time = fmod(w[y1] * 0.5 + cur_t, g[x1][y2] + r[x1][y2]);
                if (time >= g[x1][y2])
                    time = 0;
                else
                    time = g[x1][y2] - time;
                return w[y1] * 0.5 + w[y2] * 0.5 + time;
            } else {
                time = fmod(w[y2] * 0.5 + cur_t, g[x1][y2] + r[x1][y2]);
                if (time >= g[x1][y2])
                    time = 0;
                else
                    time = g[x1][y2] - time;
                return w[y2] * 0.5 + w[y2 - 1] * 0.5 + time;
            }
        } else {
            if (x1 < x2) {
                time = fmod(h[x1] * 0.5 + cur_t, g[x2][y1] + r[x2][y1]);
                if (time < g[x2][y1])
                    time = 0;
                else
                    time = g[x2][y1] + r[x2][y1] - time;
                return h[x1] * 0.5 + h[x2] * 0.5 + time;
            } else {
                time = fmod(h[x2] * 0.5 + cur_t, g[x2][y1] + r[x2][y1]);
                if (time < g[x2][y1])
                    time = 0;
                else
                    time = g[x2][y1] + r[x2][y1] - time;
                return h[x2] * 0.5 + h[x2 - 1] * 0.5 + time;
            }
        }
    }
    if (op == 3) // å·¦è½¬
    {
        double time;
        if (x1 == x2 && y1 < y2) // è¥¿å‘ä¸œè½¬å—å‘åŒ—
        {
            time = fmod(w[y1] * 0.5 + cur_t, g[x1][y2] + r[x1][y2]);
            if (time >= g[x1][y2])
                time = 0;
            else
                time = g[x1][y2] - time;
            return w[y1] * 0.5 + h[x1 - 1] * 0.5 + time;
        }
        if (x1 == x2 && y1 > y2) // ä¸œå‘è¥¿è½¬åŒ—å‘å—
        {
            time = fmod(w[y2] * 0.5 + cur_t, g[x1][y2] + r[x1][y2]);
            if (time >= g[x1][y2])
                time = 0;
            else
                time = g[x1][y2] - time;
            return w[y2] * 0.5 + h[x1] * 0.5 + time;
        }

        if (x1 < x2 && y1 == y2) // åŒ—å‘å—è½¬è¥¿å‘ä¸œ
        {
            time = fmod(h[x1] * 0.5 + cur_t, g[x2][y1] + r[x2][y1]);
            if (time < g[x2][y1])
                time = 0;
            else
                time = g[x2][y1] + r[x2][y1] - time;
            return w[y1] * 0.5 + h[x1] * 0.5 + time;
        }

        if (x1 > x2 && y1 == y2) // å—å‘åŒ—è½¬ä¸œå‘è¥¿
        {
            time = fmod(h[x2] * 0.5 + cur_t, g[x2][y1] + r[x2][y1]);
            if (time < g[x2][y1])
                time = 0;
            else
                time = g[x2][y1] + r[x2][y1] - time;
            return w[y1 - 1] * 0.5 + h[x2] * 0.5 + time;
        }
    }
}
void setxy(int *x1, int *y1, int *x2, int *y2, int cur) {
    if (cur < n * (m - 1)) {
        *x1 = *x2 = cur / (m - 1) + 1;
        *y1 = cur % (m - 1) + 1;
        *y2 = *y1 + 1;
    } else {
        cur -= n * (m - 1);
        if (cur < n * (m - 1)) {
            *x1 = *x2 = cur / (m - 1) + 1;
            *y2 = cur % (m - 1) + 1;
            *y1 = *y2 + 1;
        } else {
            cur -= n * (m - 1);
            if (cur < (n - 1) * m) {
                *x1 = cur / m + 1;
                *x2 = *x1 + 1;
                *y1 = *y2 = cur % m + 1;
            } else {
                cur -= (n - 1) * m;
                *x2 = cur / m + 1;
                *x1 = *x2 + 1;
                *y1 = *y2 = cur % m + 1;
            }
        }
    }
}
double dj(int x1, int y1, int x2, int y2, int x3, int y3, int x4, int y4,
          double t) {
    int flag[2 * (n * (m - 1) + (n - 1) * m)];
    double dist[2 * (n * (m - 1) + (n - 1) * m)];
    memset(flag, 0, sizeof(int) * 2 * (n * (m - 1) + (n - 1) * m));
    memset(dist, 0, sizeof(double) * 2 * (n * (m - 1) + (n - 1) * m));
    int cur = map(x1, y1, x2, y2), to;
    priority_queue<Pos> q;
    // q.push(Pos(cur,0));
    double min_dist;
    flag[cur] = 1; // printf("%d map\n",cur);
    while (1) {
        double next_dist;
        // è°ƒå¤´
        to = map(x2, y2, x1, y1);
        next_dist = cal_time(x1, y1, x2, y2, dist[cur] + t, 0);
        if (!flag[to] && (!dist[to] || dist[cur] + next_dist < dist[to])) {
            dist[to] = dist[cur] + next_dist;
            q.push(Pos(to, dist[to]));
        }
        // å³è½¬
        to = -1;
        if (x1 == x2 && y1 < y2 && x1 < n)
            to = map(x1, y2, x1 + 1, y2);
        if (x1 == x2 && y1 > y2 && x1 > 1)
            to = map(x1, y2, x1 - 1, y2);
        if (x1 < x2 && y1 == y2 && y1 > 1)
            to = map(x2, y1, x2, y1 - 1);
        if (x1 > x2 && y1 == y2 && y1 < m)
            to = map(x2, y1, x2, y1 + 1);
        if (to != -1) {
            next_dist = cal_time(x1, y1, x2, y2, dist[cur] + t, 1);
            if (!flag[to] && (!dist[to] || dist[cur] + next_dist < dist[to])) {
                dist[to] = dist[cur] + next_dist;
                q.push(Pos(to, dist[to]));
            }
        }
        // ç›´è¡Œ
        to = -1;
        if (x1 == x2 && y1 < y2 && y2 < m)
            to = map(x1, y2, x1, y2 + 1);
        if (x1 == x2 && y1 > y2 && y2 > 1)
            to = map(x1, y2, x1, y2 - 1);
        if (x1 < x2 && y1 == y2 && x2 < n)
            to = map(x2, y1, x2 + 1, y1);
        if (x1 > x2 && y1 == y2 && x2 > 1)
            to = map(x2, y1, x2 - 1, y1);
        if (to != -1) {
            next_dist = cal_time(x1, y1, x2, y2, dist[cur] + t, 2);
            if (!flag[to] && (!dist[to] || dist[cur] + next_dist < dist[to])) {
                dist[to] = dist[cur] + next_dist;
                q.push(Pos(to, dist[to]));
            }
        }
        // å·¦è½¬
        to = -1;
        if (x1 == x2 && y1 < y2 && x1 > 1)
            to = map(x1, y2, x1 - 1, y2);
        if (x1 == x2 && y1 > y2 && x1 < n)
            to = map(x1, y2, x1 + 1, y2);
        if (x1 < x2 && y1 == y2 && y1 < m)
            to = map(x2, y1, x2, y1 + 1);
        if (x1 > x2 && y1 == y2 && y1 > 1)
            to = map(x2, y1, x2, y1 - 1);
        if (to != -1) {
            next_dist = cal_time(x1, y1, x2, y2, dist[cur] + t, 3);
            if (!flag[to] && (!dist[to] || dist[cur] + next_dist < dist[to])) {
                dist[to] = dist[cur] + next_dist;
                q.push(Pos(to, dist[to]));
            }
        }
        cur = q.top().index;
        min_dist = q.top().value;
        q.pop();
        setxy(&x1, &y1, &x2, &y2, cur);
        // printf("%f %d %d %d %d %d pos\n"
        // ,min_dist, cur,x1,y1,x2,y2);

        if (x1 == x3 && y1 == y3 && x2 == x4 && y2 == y4) {
            return min_dist;
        }

        else
            flag[cur] = 1;
    }
}

int main() {
    int i, j;
    scanf("%d%d", &n, &m);
    for (i = 1; i <= n - 1; i++)
        scanf("%d", &h[i]);
    for (i = n - 1; i >= 2; i--)
        h[i] -= h[i - 1];

    for (i = 1; i <= m - 1; i++)
        scanf("%d", &w[i]);
    for (i = m - 1; i >= 2; i--)
        w[i] -= w[i - 1];
    for (i = 1; i <= n; i++)
        for (j = 1; j <= m; j++)
            scanf("%d", &g[i][j]);
    for (i = 1; i <= n; i++)
        for (j = 1; j <= m; j++)
            scanf("%d", &r[i][j]);
    int x1, y1, x2, y2, tx1, ty1, tx2, ty2;
    scanf("%d%d%d%d", &x1, &y1, &x2, &y2);
    tx1 = x1, ty1 = y1, tx2 = x2, ty2 = y2;
    int q;
    double re = 0;
    scanf("%d", &q);
    int xi1, yi1, xi2, yi2, xi3, yi3, xi4, yi4;
    while (q--) {
        scanf("%d%d%d%d", &xi1, &yi1, &xi2, &yi2);
        re += dj(x1, y1, x2, y2, xi1, yi1, xi2, yi2, re);
        // printf("%fre\n",re);
        scanf("%d%d%d%d", &xi3, &yi3, &xi4, &yi4);
        re += dj(xi1, yi1, xi2, yi2, xi3, yi3, xi4, yi4, re);
        x1 = xi3, y1 = yi3, x2 = xi4, y2 = yi4;
    }
    re += dj(xi3, yi3, xi4, yi4, tx1, ty1, tx2, ty2, re);
    printf("%.1f\n", re);
}
```